<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/uploads/favicion32*32.ico?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/uploads/favicion16*16.ico?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="-Greenplum," />










<meta name="keywords" content="-Greenplum">
<meta property="og:type" content="article">
<meta property="og:title" content="CentOS 6.9下GreenPlum源码编译安装及部署教程">
<meta property="og:url" content="http://www.yzmean.site/post/6398/index.html">
<meta property="og:site_name" content="Yuan Zi&#39;s Blog">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://wx4.sinaimg.cn/large/006kIAZaly1fq30eco3hgj30f8058js8.jpg">
<meta property="og:updated_time" content="2018-04-11T08:22:29.091Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="CentOS 6.9下GreenPlum源码编译安装及部署教程">
<meta name="twitter:image" content="http://wx4.sinaimg.cn/large/006kIAZaly1fq30eco3hgj30f8058js8.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.3',
    sidebar: {"position":"right","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://www.yzmean.site/post/6398/"/>





  <title>CentOS 6.9下GreenPlum源码编译安装及部署教程 | Yuan Zi's Blog</title>
  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-107904573-1', 'auto');
  ga('send', 'pageview');
</script>


  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?1dc9a4ff6dd7709198eff258b865fca8";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-right page-post-detail">
    <div class="headband"></div>
    

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Yuan Zi's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">谦虚使人进步</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            公益404
          </a>
        </li>
      
        
        <li class="menu-item menu-item-random-picture">
          <a href="https://source.unsplash.com/random" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            Random Picture
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.yzmean.site/post/6398/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yuan Zi">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/head.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yuan Zi's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">CentOS 6.9下GreenPlum源码编译安装及部署教程</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-04-11T16:22:23+08:00">
                2018-04-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/GreenPlum学习/" itemprop="url" rel="index">
                    <span itemprop="name">GreenPlum学习</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/post/6398/" class="leancloud_visitors" data-flag-title="CentOS 6.9下GreenPlum源码编译安装及部署教程">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><img src="http://wx4.sinaimg.cn/large/006kIAZaly1fq30eco3hgj30f8058js8.jpg" alt=""><br><a id="more"></a></p>
<h1 id="GreenPlum介绍"><a href="#GreenPlum介绍" class="headerlink" title="GreenPlum介绍"></a>GreenPlum介绍</h1><h2 id="PostgreSql"><a href="#PostgreSql" class="headerlink" title="PostgreSql"></a>PostgreSql</h2><p>PostgreSQL is an advanced object-relational database management system that supports an extended subset of the SQL standard, including transactions, foreign keys, subqueries, triggers, user-defined types and functions.  This distribution also contains C language bindings.</p>
<h2 id="GreenPlum"><a href="#GreenPlum" class="headerlink" title="GreenPlum"></a>GreenPlum</h2><p>The Greenplum Database (GPDB) is an advanced, fully featured, open source data warehouse. It provides powerful and rapid analytics on petabyte scale data volumes. Uniquely geared toward big data analytics, Greenplum Database is powered by the world’s most advanced cost-based query optimizer delivering high analytical query performance on large data volumes.<br>Greenplum 是基于 PostgreSQL 开发的，语法与 PostgreSQL 几乎一样。<br>本质上，Greenplum 是一个关系型数据库集群，由多个独立的数据库服务组 合成的逻辑数据库，对于用户来说 Greenplum 与 Oracle、PostgreSQL 并无不同， 都可以通过标准 SQL 语句对数据进行访问。</p>
<h1 id="GreenPlum源码编译安装"><a href="#GreenPlum源码编译安装" class="headerlink" title="GreenPlum源码编译安装"></a>GreenPlum源码编译安装</h1><p>以CentOS 6.9为例，下载地址为<a href="http://mirrors.aliyun.com/centos/6.9/isos/x86_64/" target="_blank" rel="external">阿里云镜像</a>。</p>
<p>CentOS-6.9-x86_64-bin-DVD1.iso<br>CentOS-6.9-x86_64-bin-DVD2.iso </p>
<p>强烈建议以gpadmin为用户名。</p>
<h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><h3 id="添加用户root权限"><a href="#添加用户root权限" class="headerlink" title="添加用户root权限"></a>添加用户root权限</h3><p>vim 打开 /etc/sudoers 文件 （以root权限打开）<br>找到以下两行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">## Allow root to run any commands anywhere</div><div class="line">root    ALL=(ALL)       ALL</div></pre></td></tr></table></figure></p>
<p>并在下一行添加<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gpadmin ALL=(ALL)       ALL #注意对齐</div></pre></td></tr></table></figure></p>
<p>保存并返回即可</p>
<h3 id="安装gcc-c"><a href="#安装gcc-c" class="headerlink" title="安装gcc-c++"></a>安装gcc-c++</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo yum install gcc-c++</div></pre></td></tr></table></figure>
<h3 id="安装git"><a href="#安装git" class="headerlink" title="安装git"></a>安装git</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo yum install git</div></pre></td></tr></table></figure>
<h3 id="安装cmake"><a href="#安装cmake" class="headerlink" title="安装cmake"></a>安装cmake</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">cd /home/gpadmin</div><div class="line">wget https://cmake.org/files/v3.5/cmake-3.5.2.tar.gz</div><div class="line">tar -zxvf cmake-3.5.2.tar.gz</div><div class="line">cd cmake-3.5.2</div><div class="line">./configure --prefix=/usr/local</div><div class="line">make</div><div class="line">sudo make install</div></pre></td></tr></table></figure>
<h3 id="安装pip"><a href="#安装pip" class="headerlink" title="安装pip"></a>安装pip</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">sudo yum -y install epel-release</div><div class="line">sudo yum -y install python-pip</div><div class="line">pip install --upgrade #pip版本至少为 7.x.x</div></pre></td></tr></table></figure>
<h3 id="确保已安装必需的python模块"><a href="#确保已安装必需的python模块" class="headerlink" title="确保已安装必需的python模块"></a>确保已安装必需的python模块</h3><ul>
<li>psutil</li>
<li>lockfile (&gt;= 0.9.1)</li>
<li>paramiko</li>
<li>setuptools</li>
</ul>
<h3 id="确保动态链接库共享"><a href="#确保动态链接库共享" class="headerlink" title="确保动态链接库共享"></a>确保动态链接库共享</h3><p>添加 /usr/local/lib  和 /usr/local/lib64 到 /etc/ld.so.conf 中<br>并运行命令<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo ldconfig</div></pre></td></tr></table></figure></p>
<h3 id="支持-c-11"><a href="#支持-c-11" class="headerlink" title="支持 c++11"></a>支持 c++11</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">sudo yum install -y centos-release-scl</div><div class="line">sudo yum install -y devtoolset-6-toolchain</div><div class="line">echo &apos;source scl_source enable devtoolset-6&apos; &gt;&gt; ~/.bashrc</div><div class="line">source ~/.bashrc</div></pre></td></tr></table></figure>
<h3 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo yum -y install gcc git apr bison flex  readline gcc-c++ curl-devel bzip2-devel python-devel readline-devel apr-devel libevent-devel openssl-devel perl-ExtUtils-Embed libxml2-devel openldap-devel pam pam-devel</div></pre></td></tr></table></figure>
<h2 id="安装GPORCA"><a href="#安装GPORCA" class="headerlink" title="安装GPORCA"></a>安装GPORCA</h2><h3 id="clone-GPORCA"><a href="#clone-GPORCA" class="headerlink" title="clone GPORCA"></a>clone GPORCA</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cd /home/gpadmin</div><div class="line">git clone https://github.com/greenplum-db/gporca.git</div></pre></td></tr></table></figure>
<h3 id="安装-gp-xerces"><a href="#安装-gp-xerces" class="headerlink" title="安装 gp-xerces"></a>安装 gp-xerces</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">git clone https://github.com/greenplum-db/gp-xerces.git</div><div class="line">cd gp-xerces</div><div class="line">mkdir build</div><div class="line">cd build</div><div class="line">../configure --prefix=/usr/local</div><div class="line">make</div><div class="line">sudo make install</div></pre></td></tr></table></figure>
<h3 id="安装ninja"><a href="#安装ninja" class="headerlink" title="安装ninja"></a>安装ninja</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">cd /home/gpadmin</div><div class="line">git clone git://github.com/ninja-build/ninja.git &amp;&amp; cd ninja</div><div class="line">./configure.py --bootstrap</div><div class="line">sudo cp ninja /usr/bin</div></pre></td></tr></table></figure>
<h3 id="编译安装GPORCA"><a href="#编译安装GPORCA" class="headerlink" title="编译安装GPORCA"></a>编译安装GPORCA</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">cd /home/gpadmin/gporca</div><div class="line">cmake -GNinja -H. -Bbuild</div><div class="line">sudo ninja install -C build</div></pre></td></tr></table></figure>
<h3 id="编译GreenPlum"><a href="#编译GreenPlum" class="headerlink" title="编译GreenPlum"></a>编译GreenPlum</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">cd /home/gpadmin</div><div class="line">git clone https://github.com/greenplum-db/gpdb.git</div><div class="line">cd gpdb</div><div class="line">./configure --with-perl --with-python --with-libxml --with-gssapi --prefix=/usr/local/gpdb</div><div class="line"></div><div class="line"># Compile and install</div><div class="line">make -j8</div><div class="line">sudo make -j8 install</div><div class="line"></div><div class="line"># Bring in greenplum environment into your running shell</div><div class="line">source /usr/local/gpdb/greenplum_path.sh</div></pre></td></tr></table></figure>
<p>若出现</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Greenplum Database installation complete.</div></pre></td></tr></table></figure>
<p>则说明安装成功</p>
<h1 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h1><p>以在同一台主机上的一个master节点和一个segment节点为例</p>
<h2 id="配置host文件"><a href="#配置host文件" class="headerlink" title="配置host文件"></a>配置host文件</h2><h3 id="查看ip"><a href="#查看ip" class="headerlink" title="查看ip"></a>查看ip</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ip addr show eth0</div><div class="line"># 选择inet后的ip</div></pre></td></tr></table></figure>
<h3 id="修改hosts文件"><a href="#修改hosts文件" class="headerlink" title="修改hosts文件"></a>修改hosts文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo vim /etc/hosts</div></pre></td></tr></table></figure>
<p>添加两行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;ip&gt; mdw</div><div class="line">&lt;ip&gt; sdw1</div><div class="line">#此处ip相同</div></pre></td></tr></table></figure></p>
<h3 id="修改network文件"><a href="#修改network文件" class="headerlink" title="修改network文件"></a>修改network文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo vim /etc/sysconfig/network</div><div class="line">#修改   HOSTNAME=mdw</div></pre></td></tr></table></figure>
<h2 id="创建主机列表文件和segment文件"><a href="#创建主机列表文件和segment文件" class="headerlink" title="创建主机列表文件和segment文件"></a>创建主机列表文件和segment文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">cd /home/gpadmin</div><div class="line">mkdir conf</div><div class="line">cd conf</div><div class="line">sudo vim hostlist</div></pre></td></tr></table></figure>
<p>添加以下内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mdw</div><div class="line">sdw1</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo vim seg_hosts</div></pre></td></tr></table></figure>
<p>添加以下内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sdw1</div></pre></td></tr></table></figure></p>
<h2 id="共享内存与网络参数配置"><a href="#共享内存与网络参数配置" class="headerlink" title="共享内存与网络参数配置"></a>共享内存与网络参数配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo vim /etc/sysctl.conf</div></pre></td></tr></table></figure>
<p>对照替换成以下内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">net.ipv4.ip_forward = 0</div><div class="line">net.ipv4.conf.default.accept_source_route = 0</div><div class="line">kernel.sysrq = 1</div><div class="line">kernel.core_uses_pid = 1</div><div class="line">net.ipv4.tcp_syncookies = 1</div><div class="line">kernel.msgmnb = 65536</div><div class="line">kernel.msgmax = 65536</div><div class="line">kernel.sem = 250 64000 100 512</div><div class="line">kernel.shmmax = 500000000</div><div class="line">kernel.shmmni = 4096</div><div class="line">kernel.shmall = 4000000000</div><div class="line">kernel.sem = 250 64000 100 512</div><div class="line">net.ipv4.tcp_tw_recycle = 1</div><div class="line">net.ipv4.tcp_max_syn_backlog = 4096</div><div class="line">net.core.netdev_max_backlog = 10000</div><div class="line">vm.overcommit_memory = 2</div><div class="line">net.ipv4.conf.all.arp_filter = 1</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo sysctl -p</div></pre></td></tr></table></figure>
<h2 id="加入限制参数"><a href="#加入限制参数" class="headerlink" title="加入限制参数"></a>加入限制参数</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo vim /etc/security/limits.conf</div></pre></td></tr></table></figure>
<p>添加以下内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">* soft nofile 65536</div><div class="line">* hard nofile 65536</div><div class="line">* soft nproc 131072</div><div class="line">* hard nproc 131072</div><div class="line">#  星号不能去掉</div></pre></td></tr></table></figure></p>
<h2 id="节点部署"><a href="#节点部署" class="headerlink" title="节点部署"></a>节点部署</h2><h3 id="环境变量设置"><a href="#环境变量设置" class="headerlink" title="环境变量设置"></a>环境变量设置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">source /usr/local/gpdb/greenplum_path.sh</div></pre></td></tr></table></figure>
<h3 id="配置免密码登陆"><a href="#配置免密码登陆" class="headerlink" title="配置免密码登陆"></a>配置免密码登陆</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo pip install psutil</div><div class="line">gpssh-exkeys -f /home/gpadmin/conf/hostlist</div></pre></td></tr></table></figure>
<h3 id="创建数据目录"><a href="#创建数据目录" class="headerlink" title="创建数据目录"></a>创建数据目录</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">cd /home/gpadmin</div><div class="line">mkdir gpdata</div><div class="line">cd gpdata</div><div class="line">mkdir segmentdata1 masterdata</div></pre></td></tr></table></figure>
<h3 id="环境变量配置"><a href="#环境变量配置" class="headerlink" title="环境变量配置"></a>环境变量配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vim ~/.bash_profile</div></pre></td></tr></table></figure>
<p>添加以下内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">source /usr/local/gpdb/greenplum_path.sh</div><div class="line">export MASTER_DATA_DIRECTORY=/home/gpadmin/gpdata/masterdata/gpseg-1</div><div class="line">export PGPORT=2345</div><div class="line">export PGDATABASE=testDB</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">source ~/.bash_profile</div></pre></td></tr></table></figure>
<h3 id="编写数据库启动参数文件"><a href="#编写数据库启动参数文件" class="headerlink" title="编写数据库启动参数文件"></a>编写数据库启动参数文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">cd /home/gpadmin/conf</div><div class="line">mkdir gpconfigs</div><div class="line">cd gpconfigs</div><div class="line">vim gpinitsystem_config</div></pre></td></tr></table></figure>
<p>添加以下内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">#启动参数文件内容</div><div class="line">ARRAY_NAME=&quot;Greenplum&quot;</div><div class="line">SEG_PREFIX=gpseg</div><div class="line">PORT_BASE=40000</div><div class="line">declare -a DATA_DIRECTORY=(/home/gpadmin/gpdata/segmentdata1 /home/gpadmin/gpdata/segmentdata1)</div><div class="line">MASTER_HOSTNAME=mdw</div><div class="line">MASTER_DIRECTORY=/home/gpadmin/gpdata/masterdata</div><div class="line">##### Port number for the master instance.</div><div class="line">MASTER_PORT=2345</div><div class="line"># #### Shell utility used to connect to remote hosts.</div><div class="line">TRUSTED_SHELL=/usr/bin/ssh</div><div class="line">##### Maximum log file segments between automatic WAL checkpoints.</div><div class="line">CHECK_POINT_SEGMENTS=8</div><div class="line">ENCODING=UNICODE</div><div class="line">#MIRROR_PORT_BASE=50000</div><div class="line">REPLICATION_PORT_BASE=41000</div><div class="line">#MIRROR_REPLICATION_PORT_BASE=51000</div><div class="line">#declare -a MIRROR_DATA_DIRECTORY=(/home/gpadmin/gpdata/segmentmirror1 #/home/gpadmin/gpdata/segmentmirror)</div><div class="line">MACHINE_LIST_FILE=/home/gpadmin/conf/seg_hosts</div></pre></td></tr></table></figure>
<h3 id="初始化数据库"><a href="#初始化数据库" class="headerlink" title="初始化数据库"></a>初始化数据库</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gpinitsystem -c /home/gpadmin/conf/gpconfigs/gpinitsystem_config –a</div></pre></td></tr></table></figure>
<h3 id="数据库使用"><a href="#数据库使用" class="headerlink" title="数据库使用"></a>数据库使用</h3><p>gpstart #开启数据库服务<br>gpstop #关闭数据库服务<br>gprecoverseg  #恢复启动失败的节点<br>gpstate -m #查看节点状态<br>createdb testDB #创建数据库<br>psql #连接数据库   psql –help查看更多选项</p>
<h3 id="TPC-H测试"><a href="#TPC-H测试" class="headerlink" title="TPC-H测试"></a>TPC-H测试</h3><p>运行Greenplum TPC-H测试<br>参考<a href="https://yq.aliyun.com/articles/93?commentId=29" target="_blank" rel="external">https://yq.aliyun.com/articles/93?commentId=29</a></p>

      
    </div>
    
    
    


    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div></div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/uploads/wechat.png" alt="Yuan Zi 微信支付"/>
        <p>微信支付</p>
      </div>
    

    

    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Greenplum/" rel="tag"># -Greenplum</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/post/23968/" rel="next" title="macOS High Sierra下无法使用gdb的解决办法">
                <i class="fa fa-chevron-left"></i> macOS High Sierra下无法使用gdb的解决办法
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/post/59302/" rel="prev" title="Greenplum笔记(一)-体系结构">
                Greenplum笔记(一)-体系结构 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
                <!--MOB SHARE BEGIN-->
<div class="-mob-share-ui-button -mob-share-open">分享</div>
<div class="-mob-share-ui" style="display: none">
    <ul class="-mob-share-list">
        <li class="-mob-share-weibo"><p>新浪微博</p></li>
        <li class="-mob-share-tencentweibo"><p>腾讯微博</p></li>
        <li class="-mob-share-qzone"><p>QQ空间</p></li>
        <li class="-mob-share-qq"><p>QQ好友</p></li>
        <li class="-mob-share-renren"><p>人人网</p></li>
        <li class="-mob-share-kaixin"><p>开心网</p></li>
        <li class="-mob-share-douban"><p>豆瓣</p></li>
        <li class="-mob-share-facebook"><p>Facebook</p></li>
        <li class="-mob-share-twitter"><p>Twitter</p></li>
    </ul>
    <div class="-mob-share-close">取消</div>
</div>
<div class="-mob-share-ui-bg"></div>
<script id="-mob-share" src="http://f1.webshare.mob.com/code/mob-share.js?appkey=2188e1e9decc4"></script>
<!--MOB SHARE END-->

      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="lv-container" data-id="city" data-uid="MTAyMC8zMTI1Ni83ODA1"></div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/uploads/head.png"
                alt="Yuan Zi" />
            
              <p class="site-author-name" itemprop="name">Yuan Zi</p>
              <p class="site-description motion-element" itemprop="description">I ain't gonna be just a face in the crowd .</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">4</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">7</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          <div class="links-of-author motion-element">
            
              
                <span class="links-of-author-item">
                  <a href="https://github.com/yzmean" target="_blank" title="GitHub">
                    
                      <i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  <a href="mailto:yzmean@gmail.com" target="_blank" title="E-Mail">
                    
                      <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
                <span class="links-of-author-item">
                  <a href="http://steamcommunity.com/id/flnoripple" target="_blank" title="Steam">
                    
                      <i class="fa fa-fw fa-steam"></i>Steam</a>
                </span>
              
            
          </div>

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                友情链接
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="http://shic.top/" title="this.Shi个人博客" target="_blank">this.Shi个人博客</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#GreenPlum介绍"><span class="nav-number">1.</span> <span class="nav-text">GreenPlum介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#PostgreSql"><span class="nav-number">1.1.</span> <span class="nav-text">PostgreSql</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#GreenPlum"><span class="nav-number">1.2.</span> <span class="nav-text">GreenPlum</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#GreenPlum源码编译安装"><span class="nav-number">2.</span> <span class="nav-text">GreenPlum源码编译安装</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#准备工作"><span class="nav-number">2.1.</span> <span class="nav-text">准备工作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#添加用户root权限"><span class="nav-number">2.1.1.</span> <span class="nav-text">添加用户root权限</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#安装gcc-c"><span class="nav-number">2.1.2.</span> <span class="nav-text">安装gcc-c++</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#安装git"><span class="nav-number">2.1.3.</span> <span class="nav-text">安装git</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#安装cmake"><span class="nav-number">2.1.4.</span> <span class="nav-text">安装cmake</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#安装pip"><span class="nav-number">2.1.5.</span> <span class="nav-text">安装pip</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#确保已安装必需的python模块"><span class="nav-number">2.1.6.</span> <span class="nav-text">确保已安装必需的python模块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#确保动态链接库共享"><span class="nav-number">2.1.7.</span> <span class="nav-text">确保动态链接库共享</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#支持-c-11"><span class="nav-number">2.1.8.</span> <span class="nav-text">支持 c++11</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#安装依赖"><span class="nav-number">2.1.9.</span> <span class="nav-text">安装依赖</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安装GPORCA"><span class="nav-number">2.2.</span> <span class="nav-text">安装GPORCA</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#clone-GPORCA"><span class="nav-number">2.2.1.</span> <span class="nav-text">clone GPORCA</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#安装-gp-xerces"><span class="nav-number">2.2.2.</span> <span class="nav-text">安装 gp-xerces</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#安装ninja"><span class="nav-number">2.2.3.</span> <span class="nav-text">安装ninja</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#编译安装GPORCA"><span class="nav-number">2.2.4.</span> <span class="nav-text">编译安装GPORCA</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#编译GreenPlum"><span class="nav-number">2.2.5.</span> <span class="nav-text">编译GreenPlum</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#部署"><span class="nav-number">3.</span> <span class="nav-text">部署</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#配置host文件"><span class="nav-number">3.1.</span> <span class="nav-text">配置host文件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#查看ip"><span class="nav-number">3.1.1.</span> <span class="nav-text">查看ip</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#修改hosts文件"><span class="nav-number">3.1.2.</span> <span class="nav-text">修改hosts文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#修改network文件"><span class="nav-number">3.1.3.</span> <span class="nav-text">修改network文件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#创建主机列表文件和segment文件"><span class="nav-number">3.2.</span> <span class="nav-text">创建主机列表文件和segment文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#共享内存与网络参数配置"><span class="nav-number">3.3.</span> <span class="nav-text">共享内存与网络参数配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#加入限制参数"><span class="nav-number">3.4.</span> <span class="nav-text">加入限制参数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#节点部署"><span class="nav-number">3.5.</span> <span class="nav-text">节点部署</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#环境变量设置"><span class="nav-number">3.5.1.</span> <span class="nav-text">环境变量设置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#配置免密码登陆"><span class="nav-number">3.5.2.</span> <span class="nav-text">配置免密码登陆</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建数据目录"><span class="nav-number">3.5.3.</span> <span class="nav-text">创建数据目录</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#环境变量配置"><span class="nav-number">3.5.4.</span> <span class="nav-text">环境变量配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#编写数据库启动参数文件"><span class="nav-number">3.5.5.</span> <span class="nav-text">编写数据库启动参数文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#初始化数据库"><span class="nav-number">3.5.6.</span> <span class="nav-text">初始化数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数据库使用"><span class="nav-number">3.5.7.</span> <span class="nav-text">数据库使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TPC-H测试"><span class="nav-number">3.5.8.</span> <span class="nav-text">TPC-H测试</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<div class="copyright">&copy; 2017 &mdash; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-drupal"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Yuan Zi</span>

  
<br/>
<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共5.7k字</span>
</div>
        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.3"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.3"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.3"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  












  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("KeGHByUO0Y7MPAGIUAQURkdo-gzGzoHsz", "oOJLSQFhGgxbiwOBrFxmeqB1");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  

  

  

  

  
    <script type="text/javascript" src="/live2d/script.js"></script>
    <canvas id="live2dcanvas" width="150" height="300" class="live2d"></canvas>
    <style>
      #live2dcanvas {
        position: fixed;
        right: 0px;
        z-index: 999;
        pointer-events: none;
        bottom: -30px;
      }
    </style>
    <script>loadlive2d("live2dcanvas" ,"/live2d/assets/hijiki/hijiki.model.json",0.5)</script>
  

</body>
</html>
